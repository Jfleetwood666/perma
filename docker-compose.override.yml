# overrides for local development, not used in CI
version: '3'
services:
  playwright:
    build:
      context: playwright
      x-bake:
        tags:
          - registry.lil.tools/harvardlil/perma-playwright:4-8ab77242e64440f2323b0ed4d63b8b58
        platforms:
          - linux/amd64
          - linux/arm64
        cache-from:
          - type=registry,ref='registry.lil.tools/harvardlil/perma-playwright:buildcache'
        cache-to:
          - type=registry,ref='registry.lil.tools/harvardlil/perma-playwright:buildcache,mode=max'
      x-hash-paths:
        - requirements.txt
  web:
    build:
      context: .
      dockerfile: perma_web/Dockerfile
      x-bake:
        tags:
          - registry.lil.tools/harvardlil/perma-web:16-fa4e0270c771592745474a7037ab73b0
        platforms:
          - linux/amd64
          - linux/arm64
        cache-from:
          - type=registry,ref='registry.lil.tools/harvardlil/perma-web:buildcache'
        cache-to:
          - type=registry,ref='registry.lil.tools/harvardlil/perma-web:buildcache,mode=max'
      x-hash-paths:
        - perma_web/requirements.txt
        - perma_web/npm-shrinkwrap.json
        - perma_web/package.json
        - perma_web/perma-warcprox-ca.pem
        - perma_web/lil-archive-keyring.gpg
